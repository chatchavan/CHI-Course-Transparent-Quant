---
title: "Session 3 Uncertainty visualizations"
author: "Xiaoying Pu, Lace Padilla"
date: "3/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidymodels)
library(modelr)
library(tidybayes)
library(ggdist)
library(distributional)
theme_set(theme_tidybayes())
```


## Recap: Dataset 1 Blinded with Science

## Dataset 1, frequentist land 


```{r dat1-frequentist-model2}

```


```{r dat1-frequentist-model3}

```


## Dataset 1, Bayesian land

```{r dat1-bayesian-model2}

```


```{r dat1-bayesian-model3}

```



## Dataset 2 Power Pose

Load the dataframe. Data dictionary/column description at https://github.com/yvonnejansen/posture/blob/master/data/exp2_column-description.csv 

```{r}
df2 <- read_csv("../02-bayesian_stats/data/exp2.csv")
```

We only modeled two variables: `change` and `condition`. 

- Each of the 80 participants were assigned to either "constrictive" or "expansive" conditions. 
- `change` is "a normalized measure for how people’s behavior changed over the course of the experiment (∼10 min)". The experiment was done in three phases where participants pumped balloons. `change` $ = \frac{\text{mean adjusted # of pumps in Phase 3 - mean adjusted # of pumps in Phase 1}}{\text{mean adjusted # of pumps in Phase 3}}$


```{r}
df2 %>%
  group_by(condition) %>%
  count()
```

```{r}
df2 %>%
  ggplot(aes(x = change, color = condition)) +  
  # geom_dots( alpha = 0.4) + 
  geom_density(outline.type = "full") + 
  xlab("Percent change") + 
  NULL
```


## Dataset 2 results

```{r}

# TODO: change to load rds
fit.brm <- readRDS("data/dataset2.brm.student.rds")
fit.brm
get_variables(fit.brm)
```

```{r}
(grid <- df2 %>% data_grid(condition))


(means <- grid %>% 
  add_epred_draws(fit.brm) 
  )

(preds <- grid %>% 
  add_predicted_draws(fit.brm)
)
```


```{r}
df2_range <- c(min(df2$change - 10), max(df2$change + 10))
```


```{r}
means %>%
  ggplot(aes(x = .epred, y = condition)) +
  stat_pointinterval(.width = 0)+ 
  xlim(df2_range)

means %>%
  ggplot(aes(x = .epred, y = condition)) +
  stat_pointinterval() + 
  xlim(df2_range)
```


```{r}
ggplot() + 
  stat_interval(
    aes(x = .prediction, y = condition),
    data = preds) + 
  stat_dots(
    aes(x = change, y = condition), 
    data = df2, alpha = 0.5, position = position_nudge(y = 0.1) , scale = 0.8) + 
  stat_pointinterval(
    aes(x = .epred, y = condition), 
    data = means, position = position_nudge(y = -0.1)) +
  scale_color_brewer()

```

(Rethinking: think about what these all mean)

- How wide are the intervals?


```{r}
ggplot(mapping = aes(fill = condition)) + 
  stat_slab(
    aes(x = .prediction, y = condition, thickness = stat(pdf * n)),
    data = preds, scale = 0.5) + 
  stat_dots(
    aes(x = change, y = condition, side = "bottom"), 
    data = df2, alpha = 0.5, scale = 0.7) + 
  stat_pointinterval(
    aes(x = .epred, y = condition), 
    data = means) + 
  labs(title = "Rainplot") + 
  xlim(df2_range)
```



```{r}
ggplot() + 
  stat_slab(aes(xdist = dist_cauchy(0, 2)))

ggplot() + 
  stat_slab(aes(xdist = dist_exponential(30)))
```

```{r}
grid %>% 
  add_epred_draws(fit.brm, dpar = c("mu", "sigma", "nu")) %>%
  sample_draws(30) %>%
  ggplot(aes(y = condition)) + 
  stat_slab(aes(xdist = dist_student_t(nu, mu, sigma)),
                 slab_color="gray65", alpha = 0.1, fill = NA) +
  geom_point(aes(x = change), data = df2, shape = 21, fill = "#9ECAE1",  size = 2) + 
  xlim(df2_range)
```

```{r}

```

